---
layout: default
title: 文件I/O第一篇
category: 技术文档
comments: true
---

**1.1 文件描述符** <br> 对于内核而言，所有打开的文件都是通过文件描述符引用。文件描述符是一个非负整数。当打开一个现有文件或创建一个新文件时，内核向进程返回一个文件描述符。当读或者写一个文件时，使用open或者creat返回的文件描述符标识该文件，将其作为参数传送给read或者write。UNIX系统shell使用文件描述符0与进程的标准输入相关联，文件描述符1与标准输出相关联，文件描述符2与标准出错输出相关联。<br> 依从POSIX的应用程序中，幻数0，1，2应当替换成符号常量STDIN_FILENO,STDOUT_FILENO,STDERR_FILENO。这些常量都定义在头文件<unistd.h>中。<br>
**1.2 open函数**<br> 调用open函数可以打开或创建一个文件。<br>`#include<fcntl.h>`<br>`int open(const char *pathname,int oflag,.../* mode_t mode*/);`<br>返回值：若成功则返回文件描述符，若出错则返回-1.<br> 对于open函数而言，仅当创建新文件时才使用第三个参数。pathname是要打开或者创建文件的名字。oflag参数可用来说明此函数的多个选项。用下列一个或多个常量进行“或”运算构成oflag参数（这些常量定义在<fcntl.h>头文件中）：<br>O_RDONLY 只读打开。<br>O_WRONLY 只写打开。<br>O_RDWR 读，写打开。<br> 注：大多数实现将O_RDONLY定义为0，O_WRONLY定义为1，O_RDWR定义为2，以与早期的程序兼容.<br> 在这个三个常量中必须指定一个且只能指定一个。下列常量是可选择的：<br>O_APPEND 每次写时都追加到文件的尾端。<br>O_CREAT 若此文件不存在，则创建它。使用此选项时，需要第三个参数mode，用其指定改新文件的访问权限位。<br>O_EXCL 如果同时指定了O_CREAT,而文件已经存在，则会出错。用次可以测试一个文件是否存在，如果不存在，则创建次文件，这使测试和创建两者成为一个原子操作。<br>O_TRUNC 如果此文件存在，而且为只写或读写成功打开，则将其长度截断为0.<br>O_NOCTTY 如果pathname指的是终端设备，则不将设备分配作为此进程的控制终端。<br>O_NONBLOCK 如果pathname指的是一个FIFO，一个块特殊文件或一个字符特殊文件，则此选项为文件的本次打开操作和后续I/0操作设置非阻塞模式。<br>由open返回的文件描述符一定是最小的未用描述符数值。这一点被某些应用程序用来在标准输入，标准输出或标准出错输出上打开新的文件。<br>-------未完-------